<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>懸賞通告產生器</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system,BlinkMacSystemFont,"Segoe UI","PingFang TC","Microsoft JhengHei",sans-serif;
      background: #f0f2f5;
      display: flex;
      gap: 20px;
    }
    .panel {
      background: #ffffff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .form-panel {
      width: 320px;
      flex-shrink: 0;
    }
    .form-panel h2 {
      margin-top: 0;
      margin-bottom: 16px;
      font-size: 20px;
    }
    .form-group {
      margin-bottom: 12px;
    }
    .form-group label {
      display: block;
      font-size: 14px;
      margin-bottom: 4px;
    }
    .form-group input[type="text"],
    .form-group input[type="number"],
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #d0d4da;
      font-size: 14px;
    }
    .form-group textarea {
      resize: vertical;
      min-height: 60px;
    }
    .form-group input[type="file"] {
      font-size: 13px;
    }
    .button-row {
      display: flex;
      gap: 8px;
    }
    button {
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      background: #2563eb;
      color: #fff;
      white-space: nowrap;
    }
    #btnDownload {
      background: #059669;
    }
    button:hover {
      filter: brightness(0.95);
    }

    /* 懸賞通告樣式 */
    .poster-wrapper {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }
    .poster {
      width: 600px;
      background: #ffffff;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid #d0d4da;
      position: relative;
    }
    .poster-header {
      background: #0046a5;
      color: #fff;
      padding: 10px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .badge {
      width: 72px;
      height: 72px;
      flex-shrink: 0;
    }
    .badge img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }
    .poster-title {
      font-size: 32px;
      font-weight: 700;
      letter-spacing: 8px;
    }

    .poster-body {
      position: relative;
      background: #ffffff;
    }

    /* 上半部照片 + 淺藍底 */
    .photo-strip {
      background: #e5f2ff;
      padding: 24px 30px 32px;
    }
    .photo-row {
      display: flex;
      gap: 24px;
    }
    .photo-block {
      width: 180px;
      text-align: center;
      margin: 0 auto;
    }
    .photo-frame {
      width: 180px;
      height: 220px;
      border: 1px solid #9ca3af;
      margin: 0 auto 10px;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    .photo-frame img {
      width: 100%;
      height: 100%;
      object-fit: cover;   /* 自動裁切滿版 */
      display: block;
    }
    .name-line {
      font-size: 20px;
      font-weight: 600;
      letter-spacing: 4px;
      margin-bottom: 4px;
    }
    .id-line {
      font-size: 13px;
      color: #374151;
    }

    .divider {
      height: 1px;
      background: #d1d5db;
    }

    /* 下半部正文（白底黑字） */
    .crime-section {
      padding: 20px 30px 100px;
      font-size: 15px;
      line-height: 1.7;
      background: #ffffff;
      text-align: justify;
    }

    .footer-info {
      margin-top: 20px;
      font-size: 14px;
      display: flex;
      justify-content: flex-end;
    }
    .issuer-text {
      text-align: right;
      font-size: 14px;
      color: #111827;
    }

    /* 藍色舉報電話條 */
    .phone-bar {
      position: absolute;
      left: 30px;
      bottom: 18px;
      background: #003b8f;
      color: #ffffff;
      padding: 6px 14px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
    }
    .phone-icon {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 1px solid #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
    }

    /* 紅色印章 + 大五角星 + 環形單位文字 */
    .stamp {
      position: absolute;
      right: 40px;
      bottom: 10px;
      width: 150px;
      height: 150px;
      border-radius: 50%;
      border: 4px solid #ef4444;
      color: #ef4444;
      font-size: 13px;
      text-align: center;
      pointer-events: none;
      transform: rotate(-12deg);
    }
    .stamp-star {
      position: absolute;
      top: 38%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 60px;   /* 星星加大 */
      line-height: 1;
    }
    .stamp-circle {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 120px;
      height: 120px;
      transform: translate(-50%, -50%);
    }
    .stamp-circle span {
      position: absolute;
      font-size: 12px;
      font-weight: 700;
    }
    .stamp-date {
      position: absolute;
      bottom: 18px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
    }

    /* 粗體底線強調 */
    .emphasis {
      font-weight: 700;
      text-decoration: underline;
    }
  </style>
</head>
<body>

  <!-- 左側：表單 -->
  <div class="panel form-panel">
    <h2>懸賞通告產生器</h2>

    <div class="form-group">
      <label>姓名</label>
      <input type="text" id="inputName" placeholder="例：經民連">
    </div>

    <div class="form-group">
      <label>性別</label>
      <select id="inputGender">
        <option value="男">男</option>
        <option value="女">女</option>
        <option value="其他">其他</option>
      </select>
    </div>

    <div class="form-group">
      <label>戶籍地（決定身分證字首）</label>
      <select id="inputHousehold">
        <option value="">隨機</option>
        <option value="A">台北市</option>
        <option value="F">新北市</option>
        <option value="B">台中市</option>
        <option value="D">台南市</option>
        <option value="E">高雄市</option>
        <option value="C">基隆市</option>
        <option value="H">桃園市</option>
        <option value="I">嘉義市</option>
        <option value="O">新竹市</option>
        <option value="G">宜蘭縣</option>
        <option value="J">新竹縣</option>
        <option value="K">苗栗縣</option>
        <option value="L">台中縣</option>
        <option value="M">南投縣</option>
        <option value="N">彰化縣</option>
        <option value="P">雲林縣</option>
        <option value="Q">嘉義縣</option>
        <option value="R">台南縣</option>
        <option value="S">高雄縣</option>
        <option value="T">屏東縣</option>
        <option value="U">花蓮縣</option>
        <option value="V">台東縣</option>
        <option value="X">澎湖縣</option>
        <option value="Y">陽明山</option>
        <option value="W">金門縣</option>
        <option value="Z">連江縣</option>
      </select>
    </div>

    <div class="form-group">
      <label>身份描述</label>
      <input type="text" id="inputIdentity" placeholder="例：台灣民團">
    </div>

    <div class="form-group">
      <label>懸賞金（萬元人民幣）</label>
      <div style="display:flex; gap:6px; align-items:center;">
        <input type="number" id="inputRewardMin" placeholder="最低" min="1" style="flex:1;">
        <span>至</span>
        <input type="number" id="inputRewardMax" placeholder="最高" min="1" style="flex:1;">
      </div>
    </div>

    <div class="form-group">
      <label>犯罪事由（50字內）</label>
      <textarea id="inputReason" maxlength="50"
        placeholder="例：長期在台灣社會發動抗中運動"></textarea>
    </div>

    <div class="form-group">
      <label>上傳照片</label>
      <input type="file" id="inputPhoto" accept="image/*">
    </div>

    <div class="form-group button-row">
      <button id="btnGenerate" type="button">生成懸賞通告</button>
      <button id="btnDownload" type="button">下載 PNG</button>
    </div>

    <p style="font-size:12px;color:#6b7280;margin-top:8px;">
      ※ 為避免與真實證件重複，系統會產生校驗碼錯誤的台灣身分證號，僅供娛樂用途。
    </p>
  </div>

  <!-- 右側：通告預覽 -->
  <div class="poster-wrapper">
    <div class="poster" id="poster">
      <div class="poster-header">
        <div class="badge">
          <!-- 請在同資料夾放一張 badge.png 公安徽記圖 -->
          <img src="badge.png" alt="公安徽記">
        </div>
        <div class="poster-title">悬赏通告</div>
      </div>

      <div class="poster-body">
        <!-- 淺藍底照片區 -->
        <div class="photo-strip">
          <div class="photo-row">
            <div class="photo-block">
              <div class="photo-frame">
                <img id="photoPreview" alt="照片預覽">
              </div>
              <div class="name-line">
                <span id="posterName">某某</span>
                <span id="posterGender">男</span>
              </div>
              <div class="id-line">
                中国台湾省身份证号码
                <span id="posterId">A123456789</span>
              </div>
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <!-- 白底正文區 -->
        <div class="crime-section">
          <div id="crimeText">
            我局工作掌握，某某，台灣居民，長期在境外社交平台發布、傳播涉台涉政不實信息，
            惡意攻擊抹黑國家和政府形象，煽動部分不明真相群眾產生敵對情緒，
            造成惡劣社會影響，其行為已觸犯《中華人民共和國刑法》第一百零三條之規定，
            涉嫌煽動分裂國家罪……
          </div>

          <div class="footer-info">
            <div class="issuer-text" id="issuerText">
              某某市公安局　<span id="issuerDate">2025年11月13日</span>
            </div>
          </div>
        </div>

        <!-- 藍色舉報電話條 -->
        <div class="phone-bar">
          <div class="phone-icon">☎</div>
          <div class="phone-text">举报电话：请广大群众积极提供线索</div>
        </div>

        <!-- 紅色印章 -->
        <div class="stamp" id="stamp">
          <div class="stamp-star">★</div>
          <div class="stamp-circle" id="stampCircle"></div>
          <div class="stamp-date" id="stampDate">2025年11月13日</div>
        </div>
      </div>
    </div>
  </div>

  <!-- html2canvas：用來把整個通告轉成 PNG -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <script>
    // 中國各地公安局列表
    const bureaus = [
      "北京市公安局","上海市公安局","廣州市公安局","深圳市公安局","杭州市公安局",
      "南京市公安局","成都市公安局","重慶市公安局","武漢市公安局","西安市公安局",
      "福州市公安局","廈門市公安局","青島市公安局","蘇州市公安局"
    ];

    // 台灣縣市字首對應碼
    const idMapping = {
      A:10,B:11,C:12,D:13,E:14,F:15,G:16,H:17,J:18,K:19,
      L:20,M:21,N:22,P:23,Q:24,R:25,S:26,T:27,U:28,V:29,
      X:30,Y:31,W:32,Z:33,I:34,O:35
    };
    const letterList = "ABCDEFGHJKLMNPQRSTUVXYWZIO";

    // HTML 字元 escape（避免使用者輸入破版）
    function escapeHtml(str) {
      return str.replace(/[&<>"]/g, ch => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"
      }[ch] || ch));
    }

    // 產生「格式正確但校驗碼錯誤」的台灣身分證號
    function generateFakeTaiwanId(genderStr, areaLetter) {
      let letter = areaLetter && idMapping[areaLetter] ? areaLetter : null;
      if (!letter) {
        letter = letterList[Math.floor(Math.random() * letterList.length)];
      }

      const genderDigit = (genderStr === "女") ? 2 : 1;
      const nums = [genderDigit];
      for (let i = 0; i < 7; i++) {
        nums.push(Math.floor(Math.random() * 10));
      }
      nums.push(Math.floor(Math.random() * 10)); // 先隨機末位

      const code = idMapping[letter];
      const c1 = Math.floor(code / 10);
      const c2 = code % 10;

      const all = [c1, c2].concat(nums);
      let sum = all[0] + all[1] * 9;
      let weight = 8;
      for (let i = 2; i < all.length; i++, weight--) {
        sum += all[i] * weight;
      }

      // 若剛好合法，就把最後一碼+1，強制變成不合法
      if (sum % 10 === 0) {
        nums[8] = (nums[8] + 1) % 10;
      }
      return letter + nums.join("");
    }

    // 在紅章上排成環形的單位文字
    function setStampBureau(bureau) {
      const circle = document.getElementById("stampCircle");
      circle.innerHTML = "";
      const chars = bureau.split("");
      const radius = 58;
      const cx = 60;
      const cy = 60;
      const startAngle = -Math.PI * 0.9;   // 左上
      const endAngle   = -Math.PI * 0.1;   // 右上
      const step = chars.length > 1 ? (endAngle - startAngle) / (chars.length - 1) : 0;

      chars.forEach((ch, i) => {
        const angle = startAngle + step * i;
        const x = cx + radius * Math.cos(angle);
        const y = cy + radius * Math.sin(angle);
        const span = document.createElement("span");
        span.textContent = ch;
        span.style.left = x + "px";
        span.style.top = y + "px";
        span.style.transform = `translate(-50%, -50%) rotate(${angle + Math.PI / 2}rad)`;
        circle.appendChild(span);
      });
    }

    // 生成簡體字、公安全文風格的犯罪段落（姓名／身份／事由粗體底線）
    function generateCrimeText(name, identity, reason, rewardMin, rewardMax) {
      const cleanName = escapeHtml(name || "某某");
      const cleanIdentity = escapeHtml(identity || "台湾居民");
      const cleanReason = escapeHtml(
        (reason || "长期在境外社交平台发布、传播反中抗中言论").trim().slice(0, 50)
      );

      const emName = `<span class="emphasis">${cleanName}</span>`;
      const emId   = `<span class="emphasis">${cleanIdentity}</span>`;
      const emReason = `<span class="emphasis">${cleanReason}</span>`;

      return (
        `我局工作掌握，${emName}，${emId}，${emReason}，` +
        `长期利用其身份在境外社交平台发布、传播涉台涉政不实信息，` +
        `恶意攻击抹黑国家和政府形象，煽动部分不明真相群众产生敌对情绪，` +
        `多次与境内外分裂势力勾连串联，从事损害国家统一和社会稳定的活动，` +
        `造成恶劣社会影响。其行为已触犯《中华人民共和国刑法》第一百零三条之规定，涉嫌煽动分裂国家罪。` +
        `为依法严厉打击破坏国家主权和领土完整的犯罪行为，切实维护国家安全，请广大群众积极提供线索，` +
        `凡向公安机关提供有效线索的举报人，以及配合公安机关抓获相关犯罪嫌疑人的有功人员，` +
        `我局将视情给予${rewardMin}万至${rewardMax}万元人民币的奖励。` +
        `对包庇在逃人员的，将依法追究法律责任。对打击报复举报人的，将依法严惩。`
      );
    }

    function formatCNDate(date = new Date()) {
      const y = date.getFullYear();
      const m = date.getMonth() + 1;
      const d = date.getDate();
      return `${y}年${m}月${d}日`;
    }

    // 照片預覽
    document.getElementById("inputPhoto").addEventListener("change", function(e) {
      const file = e.target.files[0];
      const img = document.getElementById("photoPreview");
      if (!file) {
        img.src = "";
        return;
      }
      const reader = new FileReader();
      reader.onload = function(evt) {
        img.src = evt.target.result;
      };
      reader.readAsDataURL(file);
    });

    // 生成按鈕
    document.getElementById("btnGenerate").addEventListener("click", function() {
      const name = document.getElementById("inputName").value.trim() || "某某";
      const gender = document.getElementById("inputGender").value;
      const identity = document.getElementById("inputIdentity").value.trim();
      let rewardMin = parseInt(document.getElementById("inputRewardMin").value, 10);
      let rewardMax = parseInt(document.getElementById("inputRewardMax").value, 10);
      const reason = document.getElementById("inputReason").value;
      const areaLetter = document.getElementById("inputHousehold").value || null;

      if (isNaN(rewardMin) || rewardMin <= 0) rewardMin = 5;
      if (isNaN(rewardMax) || rewardMax < rewardMin) rewardMax = rewardMin + 5;

      // 姓名 & 性別
      document.getElementById("posterName").textContent = name;
      document.getElementById("posterGender").textContent = gender;

      // 身分證號
      const fakeId = generateFakeTaiwanId(gender, areaLetter);
      document.getElementById("posterId").textContent = fakeId;

      // 犯罪段落（簡體，帶粗體底線）
      const crimeHtml = generateCrimeText(name, identity, reason, rewardMin, rewardMax);
      document.getElementById("crimeText").innerHTML = crimeHtml;

      // 公安局 & 日期
      const bureau = bureaus[Math.floor(Math.random() * bureaus.length)];
      const dateStr = formatCNDate();

      setStampBureau(bureau);
      document.getElementById("stampDate").textContent = dateStr;
      document.getElementById("issuerText").innerHTML =
        `${bureau}&emsp;<span id="issuerDate">${dateStr}</span>`;
    });

    // 一鍵下載 PNG
    document.getElementById("btnDownload").addEventListener("click", function() {
      const poster = document.getElementById("poster");
      html2canvas(poster, { scale: 2 }).then(canvas => {
        const link = document.createElement("a");
        link.href = canvas.toDataURL("image/png");
        link.download = `reward_poster_${Date.now()}.png`;
        link.click();
      });
    });

    // 初始先生成一次預設
    document.getElementById("btnGenerate").click();
  </script>
</body>
</html>
